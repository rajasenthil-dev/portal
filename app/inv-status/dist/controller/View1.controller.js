sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/json/JSONModel"],(e,t,o)=>{"use strict";return e.extend("invstatus.controller.View1",{onInit(){this._attachRouterPatternMatched();this._initSmartFilterBar();this._initModelErrorHandling();this._attachTableEvents()},_attachRouterPatternMatched(){const e=this.getOwnerComponent().getRouter();e.getRoute("RouteView1").attachPatternMatched(this._onPatternMatched,this)},_initSmartFilterBar(){const e=this.getView();const t=e.byId("bar0");e.setBusy(true);t.attachInitialized(()=>{e.setBusy(false)})},_initModelErrorHandling(){const e=this.getOwnerComponent().getModel();const o=this.getView().byId("table0").getTable();this.bAuthorizationErrorShown=false;e.attachRequestFailed(e=>{const{statusCode:r}=e.getParameters().response;if(r==="403"){o.setNoData("No data available due to authorization restrictions");o.setBusy(false);if(!this.bAuthorizationErrorShown){this.bAuthorizationErrorShown=true;t.error("You do not have the required permissions to access this report.",{title:"Unauthorized Access",id:"messageBoxId1",details:"Permission is required to access this report. Please contact your administrator if you believe this is an error or require access.",contentWidth:"100px"})}}})},_attachTableEvents(){const e=this.getView().byId("table0").getTable();e.attachEvent("rowsUpdated",this.calculateTotals.bind(this))},async _refreshUserModel(){const e=this.getOwnerComponent().getModel("userModel");let t=sap.ui.require.toUrl("invstatus").split("/resources")[0];t=t==="."?"":t;const o=`${t}/user-api/attributes`;try{const t=await fetch(o);const r=await t.json();e.setData(r);console.log("✅ User model refreshed:",r)}catch(e){console.error("❌ Failed to fetch user info",e)}},_fetchAndSetLogo(){const e=this.getView();const t=this.getOwnerComponent().getModel("userModel");const r=t?.getData()||{};const s=r.ManufacturerNumber;const n=e.byId("logoImage");let i=sap.ui.require.toUrl("invstatus").split("/resources")[0];i=i==="."?"":i;const a=`${i}/images/MCKCAN1.jpg`;if(!s){console.warn("No ManufacturerNumber in user model. Showing fallback logo.");n.setSrc(a);return}const c=this.getOwnerComponent().getModel("logo");const l=new o("manufacturerNumber","EQ",s);const p=c.bindList("/MediaFile",undefined,undefined,[l]);p.requestContexts().then(e=>{if(e?.length>0){const t=e[0].getObject();const o=t.url.replace(/^.*(?=\/odata\/v4\/media)/,"");const r=`${i}${o}`;n.setSrc(r)}else{console.warn("No matching logo found. Fallback image used.");n.setSrc(a)}}).catch(e=>{console.error("Binding error:",e);n.setSrc(a)})},async _onPatternMatched(){await this._refreshUserModel();console.log("RouteView1 pattern matched – fetching logo...");this._fetchAndSetLogo()},calculateTotals:function(){const e=this.getView().byId("table0").getTable();const t=e.getBinding("rows");const o=t.getContexts(0,t.getLength());o.forEach(e=>{console.log("Marketing:",e.getProperty("MARKETING_SAMPLE_QTY"));console.log("Lab:",e.getProperty("LAB_SAMPLE_QTY"))});const r=this.getOwnerComponent().getModel("i18n").getResourceBundle();const s={OPEN_STOCK:"#4CAF50",QUARANTINE:"#FF5722",RETAINS:"#9E9E9E",QUALITY_HOLD:"#FF5722",RETURNS_CAL:"#9E9E9E",RECALLS:"#F44336",INVENTORY_HOLD:"#FF5722",RELABEL_QTY:"#9E9E9E",DAMAGE_DESTRUCTION:"#F44336",MARKETING_SAMPLE_QTY:"#FF9800",LAB_SAMPLE_QTY:"#2196F3",IN_PROCESS:"#4CAF50",TOTAL_QTY:"#4CAF50"};const n=[{prop:"OPEN_STOCK",icon:"sap-icon://inventory",color:s.OPEN_STOCK},{prop:"QUARANTINE",icon:"sap-icon://alert",color:s.QUARANTINE},{prop:"RETAINS",icon:"sap-icon://save",color:s.RETAINS},{prop:"QUALITY_HOLD",icon:"sap-icon://synchronize",color:s.QUALITY_HOLD},{prop:"RETURNS_CAL",icon:"sap-icon://undo",color:s.RETURNS_CAL},{prop:"RECALLS",icon:"sap-icon://reset",color:s.RECALLS},{prop:"INVENTORY_HOLD",icon:"sap-icon://shelf",color:s.INVENTORY_HOLD},{prop:"RELABEL_QTY",icon:"sap-icon://tag",color:s.RELABEL_QTY},{prop:"DAMAGE_DESTRUCTION",icon:"sap-icon://delete",color:s.DAMAGE_DESTRUCTION},{prop:"MARKETING_SAMPLE_QTY",icon:"sap-icon://pharmacy",color:s.MARKETING_SAMPLE_QTY},{prop:"LAB_SAMPLE_QTY",icon:"sap-icon://lab",color:s.LAB_SAMPLE_QTY},{prop:"IN_PROCESS",icon:"sap-icon://process",color:s.IN_PROCESS},{prop:"TOTAL_QTY",icon:"sap-icon://sum",color:s.TOTAL_QTY}];const i=n.map(e=>{const t=o.reduce((t,o)=>t+(parseFloat(o.getProperty(e.prop))||0),0);return{key:e.prop,label:r.getText(e.prop),value:this._formatNumber(t),icon:e.icon,color:e.color}});const a=new sap.ui.model.json.JSONModel(i);this.getView().setModel(a,"totals")},_formatNumber(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e)}})});
//# sourceMappingURL=View1.controller.js.map